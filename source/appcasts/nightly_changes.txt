2019-12-16: Fix bug that broke selection

2019-12-15: Change colorspace of IBarCursor to sRGB. Before
it was grayscale and that broke screen sharing. Issue 8411

2019-12-15: Call scrollWheel: on momentum changed and ended
phases. macOS does not call these for some reason. Based on
a bit of disassembling, it's because
+NSAnimationContext.activate returns true. Issue 8538

2019-12-15: Add more debug logging to character generation

2019-12-15: Use secure coding for .itr files

2019-12-15: Confirm control sequence-initiated downloads

2019-12-14: Report three finger drags. Issue 8524

2019-12-14: Hide PTYScrollView's content view when using
metal renderer for a nice performance bump. Issue 8515

2019-12-13: [ColorPicker] Rename cornerRadius to
cpk_cornerRadius. Apple added a private -setCornerRadius:
method on NSView whose very existence causes a corner radius
to be applied. Objective C at its worst!

2019-12-13: Change tilde expansion in iterm2_git_poll to
only expand leading tildes. Issue 8558

2019-12-12: Fix crash when undo removes a trigger

2019-12-12: Move set background image nag into nagging
controller. Nag even when unsetting the background image

2019-12-11: Move Do you want the scroll wheel to move the
cursor in interactive programs like this to nag controller

2019-12-11: Move tmux supplementary plane announcement to
nag controller

2019-12-11: Add didRepairSavedArrangement to nag controller

2019-12-11: Move abort upload nag to nag controller

2019-12-11: Move abort download to nag controller

2019-12-11: Move orphan and broken pipe nags to nag
controller

2019-12-11: Move arrangement with unknown profile nag into
nag controller

2019-12-11: Request permission to report variables

2019-12-09: Make restoring and updating-on-resize of notes
and selection much more robust. Add a bunch of tests.

2019-12-07: Fix restoration of annotations. The screen's
initial size during restoration is usually different than
when it was saved. That broke restoring annotations because
the saved coordinates are a function of screen width. This
commit sets the screen size back to its initial value before
loading the annotations and then the VT100Screen restoration
function returns. PTYSession can then restore its selection
(which is also dependent on width) and then fix the screen
size back to what will actually fit in the physical window
we have. That window often gets resized again later.

There's still a bug with selection restoration when there
are more than 10k lines prior to state saving. The selection
shifts vertically because it doesn't account for the
truncation.

2019-12-07: Split navigating next/previuos mark from
annotation navigation

2019-12-07: Bump upgraded asserts to 10% sampling rate

2019-12-07: Disambiguate profile menu item-derived new
window vs new tab shortcuts by putting NewTab:title or
NewWindow:title as the identifier. It should not collide
because all other identifiers are statically defined.

2019-12-07: Revert "Disambiguate new tab vs new window in
popup list of profile names for keyboard shortcuts"

This reverts commit
961e12ac9ce1b1158962d78c2ace076fe93a37c7.

2019-12-07: Revert "Fix touch bar items that select
profiles, broken in previous commit"

This reverts commit
8758d9c4f5fd9e5ac6bb0c0d515e9112ba85e9a0.

2019-12-07: Fix touch bar items that select profiles, broken
in previous commit

2019-12-07: Disambiguate new tab vs new window in popup list
of profile names for keyboard shortcuts

2019-12-07: Disable quicklook for schemes other than http(s)

2019-12-07: Disable DECRQCRA by default. Prompt when someone
tries to use it.

2019-12-07: Work around a crash when changing the window's
style mask in/out of borderless.
https://feedbackassistant.apple.com/feedback/7483151

2019-12-06: Require permission to steal focus by control
sequence. Reveal the session after stealing focus

2019-12-06: Make it harder to misuse
iTermFileDescriptorClientConnect

2019-12-06: Reject archives with duplicate metadata keys

2019-12-06: Expand use of safe addition function

2019-12-06: Prevent possible signed integer overflow

2019-12-06: Ignore metadata keys that are not understood.

2019-12-06: Introduce v2 of signed archives. The signature
goes at the end and signs everything that precedes it,
rather than just the payload. Version 1 is still accepted as
input. Output contains the v1 header but also contains the
v2 signature, which is preferred when available. The
migration path will be to ship this and rebuild all its
files with it. Then the next version will build only v2.
Then the version after that will accept only v2, and the
migration code can be deleted.

2019-12-05: Replace direct calls to realloc(f) with safer
alternatives

2019-12-05: Add Smoooooth color preset to default set

2019-12-05: Preview color presets when highlighting one

2019-12-05: Fix GPU renderer's drawing of selected tabs

2019-12-05: A bit of cleanup for the log plaintext option in
the save panel

2019-12-05: Combine log>start and log>stop. Indicate if
logging is on with a checkmark. Remove some nasty old code.
Add the ability to log just plain text from the menu item.

2019-12-04: Add the option to log plain text. Refactor
logging.

- When a session is restored, resume its autolog if
applicable.  - When a session is restarted, begin a new log
file. Assign the session a new unique ID.  - Perform logging
on a separate queue from reading to improve parallelism.

2019-12-04: Handle starting a three-finger selection with a
mouseDragged: event. Issue 8350 (second attempt)

2019-12-04: Fix the test for whether three-finger tap
gestures for quicklook are enabled. Issue 8306

2019-12-03: Fix a bug where tmux windows' Y origin would
change if there was a tabbar that appeared shifted it down.
Issue 8509

2019-12-02: Add advanced pref to control generous rounding.
Yet another hack for f'ing consolas

2019-12-02: Rewrite paths discovered via
PROC_PIDVNODEPATHINFO to replace root-firmlinked paths with
their shorter names on 10.15 (e.g.,
/System/Volumns/Data/Blah -> /Blah). From PR 409 by
erikolofsson, modified by gnachman.

2019-12-02: Change how the git status bar component
truncates. Only offer one variant. Let the superclass know
it truncates the tail so it doesn't try to be clever about
picking a variant that fits.

2019-12-01: Remove unused lru_cache

2019-12-01: Validate the dragging source in the status bar
setup destination collection view

2019-12-01: Quarantine downloaded files

2019-12-01: Fix infinite loop for creating archive with
self-signed cert.

2019-12-01: Remove CPU profiler from menu

2019-12-01: Remove sigusr2 handler after CPU profiling is
finished

2019-11-26: Disregard dragOk_ when there are three fingers
making a drag. I don't know if dragOk_ is still useful
because it's from the big 2011 commit and there's not much
info about why it is there. I do know that three-finger
drags shuffle mouse down/up/drag in crazy ways, and in issue
8323 we see that dragOk prevents a three finger drag from
working when BetterTouchTool joins the crazy party and a
drag precedes mousedown.

2019-11-25: Reset find bar progress meter when it loses
focus

2019-11-25: Fix various analyzer complaints

2019-11-25: When popping an icon title and the stack is
empty, revert to the session name as title. Issue 8512

2019-11-25: Bump Travis to xcode 11.2

2019-11-25: Fix possible overflow in imported recordings

2019-11-24: Prevent the possibility of buffer overflow when
importing a recording

2019-11-24: Remove /private/var from image_decoder sandbox.
Doesn't seem to be necessary to decode PDFs. I tested on
10.12 and 10.14

2019-11-24: Add support for moving by a vim WORD (as opposed
to a word) in copy mode. In vim parlance, a WORD is made of
non-whitespace characters, while a word is alphanumeric.
Refactors the logical movement stuff into its own class.

2019-11-23: Remove /private/var from image decoder sandbox.
I tested it on PDFs, PNGs, JPGs, and GIFs. I tested 10.12
and 10.14. Doesn't seem to be needed any more. Maybe it was
needed by 10.11 back in 2016 when it was added?

2019-11-23: [python] Bump version

2019-11-23: [python] Catch exceptions while unsubscribing
from notifications in monitors. Also fix a missing  in
Tab.async_activate.

2019-11-23: Free palette and pixels in image decoder

2019-11-23: Decode sixel out of process

2019-11-23: Update libsixel

2019-11-23: Add support for custom shell. This lets you
choose a shell that isn't in /etc/shells and makes it a
login shell by running it from login and changing argv[0] to
start with a -. Issue 3139

2019-11-22: Improve tmux logging: show direction of traffic

2019-11-22: Update BetterFontPicker.framework

2019-11-21: Don't show document edited if session has custom
command. Issue 8507

2019-11-21: Fix typo. Issue 8500

2019-11-21: Initialize _textEditingRow. Fixes a bug where
editing the regex of any row but the first and then stopping
editing *without making changes* caused the first row to
change.

This happens because controlTextDidBeginEditing doesn't get
called if the user doesn't actually make an edit but
controlTextDidEndEditing is always called. To Apple's
credit, the docs for controlTextDidEndEditing mention this.
Plus one point for good docs, minus one million points for
an API that has been broken long enough to go to war and
vote.

2019-11-21: Update the current window after swapping tab
order in tmux integration. Issue 8488

2019-11-21: Don't translate from screen terminal in tmux
integration if default-terminal server option is set to
something not including the substring 'screen'. Issue 8203

2019-11-21: Use dispatch_source to know right away when a
process is created or destroyed. Disabled by default because
it needs optimization - it is monitoring a lot of processes,
and I think it could do less work and just monitor those on
the path to the current foreground job.

2019-11-21: Replace the long-deprecated CFBundleTypeOSTypes
with LSItemContentTypes for folders. Issue 8392

2019-11-20: Defer adding layer to root terminal view until
all sessions in the current tab have visible MTKViews. Fixes
a flash when enabling GPU render. Issue 8503

2019-11-20: Fix a bug in ensuring the uniqueness of
navigation shortcuts: user defaults was not updated. This
leads to confusion because the window setting is checked
before the other settings, so although prefs says 'no
shortcut' window may still have a shortcut. Issue 8497

2019-11-19: Make duplicate tab respect advanced pref
addNewTabAtEndOfTabs. Issue 6553

2019-11-18: Change how font size is calculated for Consolas.
Issue 8472

2019-11-18: Bump project to xcode 11.2 settings, except for
signing where they propose I use archiving. Give up, I'm
never going to use archiving.

2019-11-18: Fix warning

2019-11-18: Reduce the size of the job manager interface.
Fix a bug where tty wasn't always set

2019-11-18: Move TTY-fiddling code to its own file

2019-11-17: Fix table view cell reuse bug that caused font
names to be right aligned in Catalina

2019-11-17: Update release_stable to fail if notarization
fails

2019-11-17: Prevent a crash when creating a weak reference
to PseudoTerminal during dealloc and an out-of-bounds row in
the password manager because NSTableView gives a selectedRow
that is too big out of bounds after reloading data (it says
row 0 is selected when there are no rows).

2019-11-17: Save search history outside the main plist file
for privacy. Issue 8491

2019-11-16: Refactor killing of tasks to hide monoserver
details

2019-11-16: Eliminate pidIsChild

2019-11-16: Reduce uses of childPid and serverChildPid

2019-11-16: Don't pass fork state around where it isn't
needed by the caller

2019-11-16: Combine forkAndExec with didForkAndExec

2019-11-16: Improve error reporting for fork and exec to
simplify callsite and eventually combine forking with
post-forking calls

2019-11-16: Move fork and exec into job manager

2019-11-16: Refactor fork and exec code to prep for moving
it into the job manager

2019-11-16: Replace finishLaunchingDirectChild with
didForkParent

2019-11-16: Fix a bug where didForkParent didn't call the
completion block when using monoserver and PTYTask
attachToServer: was not defined

2019-11-16: Begin adding legacy job manager

2019-11-16: Start moving session restoration functionality
from PTYTask to iTermMonoServerJobManager

2019-11-16: Simplify iTermTask interface a little to hide
the existence of session restoration

2019-11-16: Break the dependency of TaskNotifier on PTYTask.

2019-11-14: Convert NSAssert to beta asserts sampled at 1%.
NSAssert gets compiled out, so I shouldn't have been using
it.

2019-11-14: Fix string length check

2019-11-14: Fix python argument parser's behavior when space
is left out after -c or -m

2019-11-14: [BetterFontPicker] Don't crash if an image asset
is missing

2019-11-14: Turn the action status bar component into a text
component that handles clicks rather than a button because
its baseline was misaligned and the text color was a bit
dimmer than everything else.

2019-11-14: Add status bar menu component. Try to fix mouse
down handling for status bar components.

2019-11-14: Show action's description in subtitle of open
quickly action

2019-11-14: Fix open quickly action icon

2019-11-14: Don't require a space after the shortcut for an
open quickly command. So /a will now list arrangements, and
/afoo will search for arrangements with query 'foo'.

2019-11-14: Change action shortcut to /:

2019-11-14: Speed up open quickly window animation

2019-11-14: Add actions to open quickly

2019-11-14: Add drag-drop and multiselect capability to
actions tool

2019-11-13: Change how fake middle clicks are generated to
be an OtherMouseDown rather than as LeftMouseDown with
button=2. Tangentially related to issue 8481 because it
makes it report the event properly.

2019-11-13: Do not report left clicks with multiple fingers
touching. This is how apple trackpads reports three finger
clicks. See also issue 4652. Issue 8481

2019-11-13: Prevent a crash when you can't get the position
of the upload/download menu. It crashed because
AXUIElementCopyAttributeValue set temp to NULL and then it
was CFReleased.

2019-11-12: Fix off-center traffic light buttons in native
full screen in minimal theme. Issue 8478

2019-11-11: Set window title label's string/attributedString
before computing its width to determine the text alignment.
Fixes a bug where a short label would be left aligned after
the title changes from a long label. Issue 8476.

2019-11-10: Fix gray bar that appeared when in native full
screen with one tab and no tab bar. Also appears when
changing to minimal theme in native full screen. This
happened because the style mask was not full-size content
view. Issue 8257.

Remove and re-add the tabbar titlebar accessory view when
changing its height from 0 (one tab, hidden, minimal theme)
to 38 (two tabs, visible tabbar, minimal theme) because
otherwise the OS gets confused about how high it should be.

Update the tab bar control's height when updating its style
so that the transition from regular to minimal makes it
grow. Outside full screen this happens as a side-effect of
changing the window style or in -[iTermRootTerminalView
layoutSubviews], but the former doesn't happen for obvious
reasons and the latter because it doesn't consider itself
the owner of the tabbar (it's on loan).

2019-11-10: Don't set documentedEdited for child jobs named
login or iTerm2. Issue 3139

2019-11-09: Improve debug logging for hasNontrivialJob

2019-11-09: Fix failing test

2019-11-09: [python] Bump version to 1.9

2019-11-09: Add support for getting the default profile

2019-11-07: Enable dragging the window by the add-tab
button. Issue 8046

2019-11-07: Put title background and window border in layers
when using metal on 10.14. Issue 8454

2019-11-07: Put a dot in the close button when a job other
than the shell is running. Issue 3139

2019-11-07: Don't let password manager create New Account 10
or higher. Somehow a user got stuck trying larger and larger
account numbers. I don't see how it can happen but this
gives a backstop. Issue 8452

2019-11-07: Update touch bar in full screen to show the
proper tab title. Issue 8447

2019-11-06: [python] Add Session.async_get_contents to docs.

2019-11-06: Replace ascii texture NSCache with a cache of my
own design because NSCache sometimes evicts objects
immediately after adding them for no discernable reason.
Issue 8441

2019-11-05: Add the option to have separate window titles
per tab. Issue 8431

2019-11-05: When the window title is set with OSC 2, set the
window title to that value ignoring title components. Issue
8431

2019-11-05: Fix an off-by-one error that prevented find-next
from navigating to a result on the first line. Issue 8426

2019-11-05: Respect the desired size of custom status bar
component popovers. From mailing list: [iterm2-discuss] A
custom iterm2.util.Size doesn't seem to have any effect when
provided to a popover component.

2019-11-04: Add support for 2-factor suffixes to password
manager

2019-11-04: [BetterFontPicker] Preserve weight when changing
font.

2019-11-03: Add git push back to release_beta

2019-11-03: Close downloads window when installation fails
because of bad zip or bad signature

2019-11-03: Fix Python 3.8 compatibility bug - was catching
too specific of an exception for asyncio.CancelledError

2019-11-03: Add ability to download site-packages separately
from the rest of iterm2env.
