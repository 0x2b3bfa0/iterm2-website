2020-04-26: Make custom command an interpolated string.
Issue 2219

2020-04-25: Make 'send text at start' an interpolated
string. Add parentSession nonterminal variable to session
context; it is the scope of the session that was current or
was split when the new session got created. Issue 2219

2020-04-25: Fix warning

2020-04-25: Make xcode happy because it doesn't know how to
parse objective c

2020-04-25: Fix a bug where transparent windows didn't use
premultiplied alpha in GPU renderer. I'm not sure how I
failed to see this before; I suspect there's something else
I'm overlooking now. I tested with and without background
images.

2020-04-24: Add logging, fix a bug where untitled windows
wouldn't open in quiet mode

2020-04-24: Refactor untitled window state machine into its
own file with better debug logging

2020-04-24: Fix vertical centering of new python script
icons

2020-04-24: Install Python runtime if needed before showing
the new script window. This lets us populate the available
Python versions if you choose full environment.

2020-04-24: Add polish to the REPL + unix domain socket
experience

2020-04-24: Listen on both unix domain and tcp sockets for
Python API

2020-04-24: Deprecate CONNECT_FLAGS. Avoid using pyobjc when
not necessary

2020-04-23: Make status bar height adjustable by an advanced
pref. Issue 7702

2020-04-22: Fix a bug where the background color view didn't
get updated when the GPU renderer was enabled. When the GPU
renderer is subsequently disabled temporarily, the wrong
background color becomes visible. Issue 8843

2020-04-22: Change control sequence for terminal reporting
(https://github.com/mintty/mintty/issues/881)

2020-04-22: Update window's background color when a session
in the current tab's transparency changes. Issue 8838

2020-04-22: Fix build break

2020-04-21: Make sure I know when the nightly build fails

2020-04-21: Handle errors due to a pane closing right away
after creation in tmux. Improve the behavior of error
toleration to run callbacks for all commands in a list.
Improve tmux logging. Issue 8787.

2020-04-21: Work around a macOS bug where setting the window
appearance just after creating a full screen window from a
full screen window creates a black space you can't get rid
of. Issue 8842

2020-04-21: Add support for SDA 2
(https://github.com/mintty/mintty/issues/881) to report
terminal name and version

2020-04-21: Finish implementing new auth model escape hatch

2020-04-21: Skip decendants when removing command history
database to make it faster

2020-04-20: Add help button for python auth

2020-04-20: Add ability to disable applescript auth

2020-04-19: Only use touch bar mitigations for esc when the
keypress comes from the touch bar

2020-04-19: Show a message while resizing indicating if any
of the windows dimensions are fixed. Give maximized windows
the resizable flag so this is visible. An attempt to reduce
the confusion seen in issue 8809.

2020-04-19: Prevent resizing full-width x-of-screen windows.
I think that's more sensible than making them snap back to
their original size

2020-04-19: [BFP] Tell xcode to shut its pie hole

2020-04-19: [BFP] Update framework

2020-04-19: [BPF] Load fonts asynchronously.

2020-04-19: Don't forget favorites when toggling a star
while searching. Issue 8835

2020-04-19: Fix typo "charactesr" -> "characters" (#418)


2020-04-18: Don't save screen to scrollback on CSI H CSI J
unless you're in alternate screen mode. Issue 8822

2020-04-18: Add detail text for session items in open
quickly that gives their command, user@host, directory, or
badge. Use the most informative of those by looking at which
has the most distinct values. Issue 8829

2020-04-17: Don't call broken pipe when failing to connect
to the server. Instead call it when you do connect to the
server but the child is unknown (which I don't think will
happen normally, but I guess it could happen if the state
restoration gets confused because there were 2 instances of
the app running and you have a bogus pid in the arrangement)

2020-04-17: Check euid of attaching process to unix domain
socket

2020-04-17: Add applescript-based auth module

2020-04-16: Fix autoresizing mask for border views

2020-04-16: Refactor multiserver to allow larger messages
and play nice with streams (no zero length messages, add
message length header to all messages, make hello regular).
Also make more stuff async; use dispatch_sources to wait for
reads and writes to be ready. The server blocks on reads and
writes so the client must not block or it can deadlock.
There are still bugs. I need to bump the protocol version
and I need to debug the asan issue I get in the server on
parser failure

2020-04-16: Remove outdated comment since
taskWasDeregistered has been eliminated

2020-04-15: Add variables for user's selection (#417)

Co-Authored-By: George Nachman <gnachman+github@gmail.com>

2020-04-12: Update menu and dock visibility when the active
space changes. windowDidBecomeKey: happens too early and the
presentation controller thinks the window is not on the
current space. Issue 8815

2020-04-11: Fix buffer overrun when the URL action factory
uses a text extractor asynchronously after the grid size
changes (the extractor's logical window could be too big,
having been set before the change).

2020-04-11: When a window gets resized using accessibility
APIs, disable snap to grid

2020-04-11: Fix use-after-free bug in multiserver

2020-04-11: Finish implementing Applescript auth

2020-04-11: Add experimental support for unix domain sockets
for the Python API. Issue 8714

2020-04-09: Use lovingly crafted images for the window
corners instead of bezier curves because it's literally
impossible to make NSBezierCurve do anything pixel-perfect.

2020-04-09: Add missing functions to Session doc. Update
menu IDs

2020-04-09: Use a view-based tableview for key mappings

2020-04-09: Fix the description of Select Menu Item actions
in keybinding tables

2020-04-08: Add `saveScrollBufferWhenClearing` advanced pref
(#416)


2020-04-07: Preserve font when printing in black and white.
Issue 8810

2020-04-07: Cancel in-band file transfers if they exceed
their declared size

2020-04-07: Replace ITUpgradedNSAssert with
ITAssertWithMessage

2020-04-07: Replace calloc with safer iTermCalloc

2020-04-07: Remove unnecessary call to killOrHideTmuxWindow
that confused the dickens out of macOS by closing a window
that had a sheet.

2020-04-07: Assert that iTermExpressionEvaluatorGlobalStore
is only called on the main queue.

2020-04-07: Ask before allowing a control sequence to change
the current profile

2020-04-07: Fix a bug where renaming a tmux pane used Edit
Info and modifying Session Name didn't work

2020-04-07: When showing tmux title, include tmux arrow
indicator

2020-04-06: Fix frame of imageView, backgroundColorView, and
legacyScrollerBackgroundView in tmux mode

2020-04-05: Fix some bugs in minimaps: update them when the
number of lines in scrollback history changes. Ensure they
all update at the same time.

2020-04-05: Work around one of the weirder quirks of macOS.
NSScrollView tries to outsmart you when you put a view over
a scroller, but it forgets that the most important part of
outsmarting someone is not being dumb. It proceeds to
trigger bugs and crazytimes. See the snarky comment for
details.

2020-04-05: Make beta users upgrade to pyenv 63 to test
module 1.11 and Python 3.8.2

2020-04-05: Add an Applescript call to request a cookie.

2020-04-05: Add support for sublime text 4 in semantic
history

2020-04-05: [SignedArchive] Give the verifier the ability to
check for the version number. Give resign the ability to
resign more than one file. Move SIGArchiveCommon.m into the
SignedArchive folder and add it to the project.

2020-04-05: Re-sign ITS files with v2 sigarchive

2020-04-04: Add debug logging for issue 8701

2020-04-04: Update zshrc in the right location when ZDOTDIR
is set. Prefer $HOME to ~ for fish

2020-04-04: Update dokc/menu visibility after hotkey window
finishes rolling in. Issue 8487

2020-04-04: Add support for swiping between tabs. Issue 1350

2020-04-04: Improve debug logging for failed file transfers

2020-04-04: When search results are shown in the scrollbar,
also show the locations of marks

2020-04-02: Refactor minimap view

2020-04-02: Remove ugly animation when unhiding toolbelt.
Especially visible in minimal + dark background + light
theme

2020-04-02: Make animating tags in profile list view look
good

2020-04-01: Use view-based tableview for profile tags.
Adjust the row height to look more normal

2020-04-01: Make about window wider

2020-04-01: Hide vertical scroller in large composer view
because legacy scrollers there are ugly as sin

2020-04-01: Use visual effect view for minimal paste
progress view. ARCify PasteView and FindView to prevent
leaks

2020-04-01: Use a visual effect view for the minimal find
view

2020-04-01: Respect prompt before closing settings when
closing all tabs in window. Issue 8800

2020-04-01: Clean up some odds and ends in the composer

2020-04-01: Add composer tip of the day

2020-04-01: Add a menu item to open the composer. Add some
polish to the existing status bar composer UI. Add a new UI
for when there isn't a status bar.

2020-03-31: Make the hamburger button in the toolbelt open
on mouse-down

2020-03-30: Truncate tail of toolbelt titles

2020-03-30: Fix hamburger frame when resizing width of
toolbelt

2020-03-30: Fix centering of toolbelt titles

2020-03-30: Add hamburger menu to toolbelt

2020-03-30: Remove header view from jobs tool

2020-03-30: Use a visual effect view behind the toolbelt in
10.14+

2020-03-29: Hide shared background image when subpixel AA is
on. Make legacy scrollers opaque when using shared bg image
since now there isn't anything under them. Fix the fill
operation when drawing the background color. I couldn't find
any case that need NSCompositingOperationCopy, so I changed
it to SourceOver only but I might have missed something.
Also, delay disabling blur because it seems to happen faster
than updating the view hierarchy and it looks bad for one
frame.

2020-03-29: Make toggling separate background images per
pane immediately update GPU renderer availability

2020-03-29: Make changes to 'use GPU rendering' take effect
immediately

2020-03-29: Fix ugly subpixel AA with legacy renderer on
10.14+. macOS fails to find the right background color and
it looks horrible. This diff makes iTermTextDrawingHelper
draw the background color itself in such cases, and the
background color view is hidden. However, legacy scrollers
still need something behind them so this diff adds a new
view to provide a background color there.

2020-03-29: Extend MTKView under per-pane titlebar and
per-pane bottom status bar. This makes background images
match the legacy renderer, which places an imageview under
the session view.

2020-03-29: Fix a bug where tasks would get
double-registered. When you launch a job, don't add it to
unattached children. If the orphan server adopter comes
along later it'll adopt those children and register them a
second time. When one of those jobs gets killed by closing
the window, only one of the registered tasks gets removed.
The other hangs around and causes select() to return an
EBADF error right away, making everything hang.

Close file descriptors and set their fd to -1 atomically to
avoid possible race conditions where the same FD gets closed
twice, possibly closing some random other thing.

Make extra sure that when a file descriptor is closed it
also gets deregistered.

Fix a bug where we'd deregister a task while iterating the
array of tasks, thus mutating the array that was being
iterated.

2020-03-29: Remove stray space

2020-03-29: Fix some warnings related to multiserver and
rootTerminalViewTabBarBackgroundColorIgnoringTabColor and
left shift of signed long long uniqueID.

2020-03-29: Improve performance of background images on
10.14+ by putting them in their own view for the legacy
renderer. Issue 7399

2020-03-28: Deal with spacelessApplicationSupport that's
empty or contains spaces. Issue 8792

2020-03-28: Add debug logging for issue 8792

2020-03-28: Add more variants to hostname using the first
part of the host name, provided there are at least two
parts. Issue 8786

2020-03-27: Add support for VSCodium to semantic history

2020-03-27: Don't count border width as decoration on macOS
10.14. Issue 8571. This won't affect 10.13 because it
doesn't get the fancy border views.

2020-03-27: Set the disconnected flag before calling
tmuxHostDisconnected so that it can't try to resize the
window as a side-effect of unburying the gateway. Issue 8793

2020-03-27: Adjust search results minimap size to match
width of overlay scroller. Use animations to match the
scroller's animations.

2020-03-26: Tweak color of X in tab colors menu. Reset state
on mouse exit.

2020-03-26: Polish the heck out of the tab color menu item

2020-03-25: Adjust alpha value of light text in autocomplete
popover to improve legibility

2020-03-25: Update search query from find pasteboard when
switching tabs, creating temporary status bar search field,
or changing panes. Issue 8784

2020-03-24: Improve multiserver logging

2020-03-24: Fix cmd-shift-up/down arrow in text views

2020-03-24: Turn off zombies in nightly build.

2020-03-23: Require user consent to clear scrollback history
with CSI 3 J. Fix a bug in announcements that have shortcuts
and are dismissable by keydown that the shortcuts didn't
work. Issue 5058

2020-03-23: Fix initial enabled state of the configure
status bar button when show status bar is off

2020-03-23: Never produce a null string from
iTermFindPasteboard. Issue 8783

2020-03-23: Get rid of absurd hacks from a long time ago.
Now that there are real weak pointers, I don't need to keep
track of whether a PTYSession is registered. In fact, I
think I never had to do it at all; I should've just nilled
out PTYTask's delegate after calling stop.

2020-03-23: Make orphan adoption more async. Search for
sockets in a background queue. There's no need to block the
main queue while doing any of this work. It's guaranteed to
begin only after all window states have finished restoring,
and can then take as along as it likes. Issue 8781

2020-03-22: Fix a bug where the flags-changed event tap was
disabled when the app resigned key and the app that was
becoming key had secure input turned on. You can actually
run a flags-changed event tap when secure input is on. This
caused a really hard to understand bug where double-tap to
open hotkey would break when both iTerm2 and the app being
switched to had secure input enabled. Issue 8180

2020-03-22: Handle unsupported shell when using
internet-based shell integration installer

2020-03-22: Fix a bunch of bugs in internet-free shell
integration installation.

2020-03-22: Support ZDOTDIR in internet-free shell
integration install. Update the wording in the steps to be
more accurate

2020-03-22: When you add your first touch bar item post a
notification explaining how to customize the touch bar.
Issue 8775

2020-03-22: Improve how the find pasteboard is used. Only
update the key window's search fields. When you do Erase
Search History, clear out the current query. Issue 8782

2020-03-21: Giant refactor of key bindings code.

Add iTermKeystroke, iTermTouchBarItem,
iTermKeybindingAction, iTermKeyMappings,
iTermTouchbarMappings, and iTermPResetKeyMappings. Delete
ITKeyBindingMgr.

Various odds and ends got cleaned up.

The only real fix is that now shortcuts in the table views
will be consistent with shortcuts in the shortcut input
view. For example, shift + : will show up as ; in both
places now.

Issue 8770

2020-03-19: Tweak wording of inline image display permission
prompt. Issue 8771

2020-03-18: Giant refactor of multiserver. Fixes a bunch of
synchronization bugs. Introduces some new synchronization
mechanisms to make code like this safer.

Also fixes a bug where multiserver didn't catch sigpipe.

2020-03-18: Fix leak of session made from adopting an orphan

2020-03-14: Prevent a crash when controlTextDidEndEditing:
is called on the window arrangement prefs panel but now row
is selected. Happens if you delete a row while editing it
name.

2020-03-14: Add option to focus window on right or middle
click. Issue 4918

2020-03-14: Don't close tmux integration session if a window
doesn't exist when you try to open it. The window may have
died on its own after it was created. Issue 8767.

2020-03-14: Add a checkbox to the tmux dashboard to control
whether it opens when there are hidden windows. Issue 8691

2020-03-14: Show search result locations in scroll bar.
Issue 5302

2020-03-12: Allow 2-touch mouse-down to get reported. Issue
8481

2020-03-12: Support symlinks in DynamicProfiles, and also
support DynamicProfiles itself being a symlink

2020-03-11: Use dark text on fake window title bar when it
has a light tab color

2020-03-11: Update title and border views when changing the
tab color so that when there's a Minimal window without a
tabbar its background will change. Issue 8760

2020-03-11: Add debug logging for all NSBeep calls

2020-03-11: Don't create a flags-changed event tap when the
advanced pref says not to. Issue 3316

2020-03-11: Save overridden fields in arrangement. When
restoring, use the underlying profile when available and
then modify it by copying over the overridden fields from
the arrangement. Issue 8759 (and countless others)

2020-03-09: Remove some silly functions that didn't need to
exist

2020-03-09: Fix a bug where option to not report a mouse
event was broken in the recent refactor. Issue 8756

2020-03-08: Cancel three finger tap if the touches move.
Issue 8751

2020-03-08: Show number of search results in find-on-page
text field. Issue 4578

2020-03-07: Fix crash

2020-03-07: Add menu item to prompt to convert tabs to
spaces when pasting. Issue 6288

2020-03-07: Fix typo

2020-03-07: Move tabbar into titlebar accessory when
channging number of tabs, if needed

2020-03-07: Change how smart selection actions are run to
use the command runner instead of system(). Log output to
script console. TODO: Ensure the command runner is retained.
Issue 8753

2020-03-06: Fix failing tests

2020-03-06: Optimize Images. PR 415.

2020-03-05: Add a bunch of debug logging for issue 8738

2020-03-05: Fix AutoLaunch.scpt

2020-03-05: Fix the preview of window arrangements with
multiple monitors. Issue 8706

2020-03-05: Pass the curor's rect in place of the view rect
to UAZoomChangeFocus. This is what chromium does in
render_widget_host_view_mac.mm. Issue 8642

2020-03-05: Add the option of setting ITERM2_COOKIE in new
sessions. These cookies are reusable. If you need to be able
to launch Python scripts from an iTerm2 session without
confirmation, this is a secure way to do it. It is secure
because processes external to iTerm2 can't get their hands
on these cookies and the user has to give permission to
enable this; the threat model is to prevent access from
other apps, particularly web browsers, from gaining access
to the API. Suggested in issue 8714

2020-03-03: Allow Applescript to launc Python script with
absolute path. Issue 8717

2020-03-03: Don't crash if profiles have crazy values, which
can happen with dynamic profiles.

2020-03-03: Try to fix screenDidLock crash by removing
observer on dealloc. Use different method names for the
class vs instance observers so I can tell which one is
crashing

2020-03-03: Enable zombies in the nightly build to track
down crashes

2020-03-01: Call refresh immediately after handling input
that comes within 10ms of a keystroke to reduce latency.
This is good for about 20ms of latency with the Metal
renderer according to typometer.

2020-03-01: Disable metal stats to try to prevent memory
corruption

2020-03-01: Respond to OSC 4 and 10, and 11 with 16 bit
color components. See mailing list thread with subject line
"Vim cannot detect background correctly when ssh to a remote
server"

2020-03-01: Support control-arrow keys in CSI u mode. Issue
8719

2020-03-01: Add an experimental setting (on in beta) that
makes mouse wheel clicks always scroll. Issue 8419

2020-03-01: When TERM contains 'screen' convert control
sequences internally to xterm. Issue 8726

2020-03-01: Add support for translating TERM=screen codes
outside tmux integration

2020-03-01: Make window background not normally clear
because it breaks the light colored outline around windows
on macOS 10.15. Consequently, we do not need the tabbar
backing to be visible in compact windows. Also, fix how we
decide whether the division view should be visible when
tabbar is on loan

2020-03-01: Ensure window changes size when tabbar as
titlebar accessory disappears/appears. Ensure tabbar becomes
titlebar accessory when exiting full screen (either kind).
Issue 8731

2020-03-01: Organize the methods in PTYTextView into
sections and remove some dead code

2020-03-01: Replace calls to mouseHandlerCurrentSelection
with selection

2020-02-29: Move mouse handling code into its own file to
reduce the size of PTYTextView
